# Front-end Review – Login to Event Analysis

_Date_: 2025-02-15  
_Reviewer_: Codex (GPT-5)

## Scope

Deep dive of the authenticated front-end workflow: login, dashboard shell, event
catalog/search, ingestion UI, and the event-analysis surface.

## Findings

1. **Login form sends untrimmed credentials (High)** – `validateForm` trims the
   in-memory email/password but the submitted `FormData` reuses the raw state
   values, so trailing spaces pass validation yet fail authentication. Users can
   be locked out with no actionable error (`src/app/login/page.tsx:55-86`). Trim
   before appending to `FormData` (and normalise case) to keep client/server in
   sync.
2. **Dashboard shows nothing once an event is selected (High)** – After the
   loading/empty states, the "selected" branch simply renders an empty flex
   container with a comment
   (`src/components/dashboard/DashboardClient.tsx:220-266`). Users who pick an
   event see a blank screen rather than KPIs, recent heats, or shortcuts to
   deeper analysis.
3. **Selecting an event does not load analysis data automatically (High)** –
   `EventAnalysisSection` only dispatches `fetchEventAnalysisData` when its
   section scrolls into view or when a tab is clicked
   (`src/components/dashboard/EventAnalysisSection.tsx:204-250`). The dashboard
   CTA says "Select an event to view analysis", but after choosing one the user
   just sees a placeholder instructing them to scroll. This lazy-load gate
   should be removed or a fetch should be triggered immediately on selection.
4. **Weather request can update the wrong event (Medium)** – The weather
   `useEffect` fires a bare `fetch` without an `AbortController` and it
   unconditionally calls `setWeather` / `setWeatherError` when the promise
   resolves (`src/components/dashboard/EventAnalysisSection.tsx:150-187`).
   Rapidly switching events can therefore flash stale weather data or throw
   "state update on unmounted component" warnings.
5. **Events list suffers from racing responses (Medium)** – The `fetchEvents`
   effect never aborts previous requests
   (`src/components/events/EventsPageClient.tsx:166-212`). Tweaking filters
   quickly (order, pagination, date range) allows older responses to land last
   and overwrite the state with stale rows.
6. **Events table & cards are mouse-only (Medium)** – Both the table rows and
   the grid cards rely on `onClick` but have no `role`, `tabIndex`, or keyboard
   handlers (`src/components/events/EventsPageClient.tsx:589-606` and
   `src/components/events/EventsPageClient.tsx:648-681`). Keyboard and
   assistive-tech users cannot open an event to analyse it.
7. **Bulk import blocks on sequential calls (Medium)** – `handleBulkImport`
   awaits each `importEvent` serially inside a `for` loop
   (`src/components/event-search/EventSearchContainer.tsx:2024-2065`). Importing
   10+ events ties up the UI thread for minutes, there’s no progress
   cancellation, and the only feedback is a slowly incrementing counter.
   Queueing the requests or running them concurrently with per-event progress
   would prevent the UI from stalling.
8. **Event search container is an untestable monolith (Medium)** –
   `EventSearchContainer.tsx` has grown past 2,400 lines with mixed
   responsibilities (form persistence, API orchestration, polling, error
   shaping, pagination, entry-list scraping). This makes unit testing, reasoning
   about side-effects, or onboarding new contributors extremely difficult.
   Breaking it into smaller hooks/components (e.g., persistence, ingestion
   orchestrator, polling service) would improve reliability and unlock reuse.
9. **Comparisons tab is a stub despite UX promises (Low)** – The Comparisons tab
   that users are told to prepare for by selecting drivers merely renders
   placeholder copy (`src/components/event-analysis/ComparisonsTab.tsx:1-11`).
   This creates a dead-end: the Drivers tab CTA can’t be satisfied and there’s
   no guard/feature flag in the navigation to warn users.
10. **Weather/details fetch triggered per view causes duplicate network work
    (Low)** – Every time the dashboard weather section remounts it re-hits
    `/api/v1/events/{id}/weather`, even if the user already opened the
    standalone Event Analysis page moments earlier. Caching the response in
    Redux or SWR and keying it by event would avoid extra API load.

## Recommendations

- Trim and normalise credentials before posting them, and surface field-level
  error focus so people can recover quicker.
- Restore the dashboard widgets (even a minimal summary of the selected event)
  so that choosing an event produces tangible output.
- Fire `fetchEventAnalysisData` immediately when `selectedEventId` changes, then
  optionally keep the IntersectionObserver as a guard for prefetching related
  visuals.
- Guard asynchronous fetches (weather, events list) with abort controllers tied
  to the current selection/filter state.
- Convert clickable rows/cards into actual buttons/links (or add
  `role="button"`, `tabIndex=0`, `onKeyDown` handlers) to satisfy WCAG 2.1.1.
- Move the ingestion workflow into its own hook/service so the UI can kick off
  multiple imports concurrently and surface per-event progress/cancel
  affordances.
- Break `EventSearchContainer` into smaller, typed hooks/components; the current
  sprawl hides bugs and requires repeated lint waivers.
- Hide or feature-flag the Comparisons tab until real charts land, or at minimum
  show a roadmap tooltip instead of a dead tab.
- Cache per-event weather/summary data in Redux/query caches and reuse it across
  both dashboard and `/events/analyse/[eventId]` to reduce spinner time.
